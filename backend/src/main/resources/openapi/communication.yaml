paths:
  Identity:
    get:
      summary: Get all identities.
      tags:
        - identity
      operationId: getIdentities
      responses:
        200:
          description: Successful response containing all identities
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Identity'
        500:
          $ref: '../thereabout.openapi.yaml#/components/responses/500'
    post:
      summary: Create a new identity.
      tags:
        - identity
      operationId: createIdentity
      requestBody:
        description: The identity to create
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Identity'
      responses:
        200:
          description: Successful response containing the newly created identity
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Identity'
        400:
          $ref: '../thereabout.openapi.yaml#/components/responses/400'
        500:
          $ref: '../thereabout.openapi.yaml#/components/responses/500'
  IdentityById:
    put:
      summary: Update an existing identity.
      tags:
        - identity
      operationId: updateIdentity
      parameters:
        - in: path
          name: id
          schema:
            type: number
            example: 42
          required: true
          description: The id of the identity to update
      requestBody:
        description: The identity data to update
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Identity'
      responses:
        200:
          description: Successful response containing the updated identity
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Identity'
        404:
          $ref: '../thereabout.openapi.yaml#/components/responses/404'
        500:
          $ref: '../thereabout.openapi.yaml#/components/responses/500'
    delete:
      summary: Delete an identity.
      tags:
        - identity
      operationId: deleteIdentity
      parameters:
        - in: path
          name: id
          schema:
            type: number
            example: 42
          required: true
          description: The id of the identity to delete
      responses:
        204:
          description: The identity was successfully deleted
        500:
          $ref: '../thereabout.openapi.yaml#/components/responses/500'
  IdentityInApplicationByApplication:
    get:
      summary: Get all application identities for a given application.
      tags:
        - identity-in-application
      operationId: getIdentityInApplicationsByApplication
      parameters:
        - in: query
          name: application
          schema:
            type: string
            example: "WhatsApp"
          required: true
          description: The application name to filter by
      responses:
        200:
          description: Successful response containing all application identities for the given application
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/IdentityInApplication'
        500:
          $ref: '../thereabout.openapi.yaml#/components/responses/500'
  IdentityInApplicationUnlinked:
    get:
      summary: Get all unlinked application identities.
      tags:
        - identity-in-application
      operationId: getUnlinkedIdentityInApplications
      responses:
        200:
          description: Successful response containing all unlinked application identities
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/IdentityInApplication'
        500:
          $ref: '../thereabout.openapi.yaml#/components/responses/500'
  IdentityInApplicationLink:
    put:
      summary: Link an application identity to an identity.
      tags:
        - identity-in-application
      operationId: linkIdentityInApplication
      parameters:
        - in: path
          name: id
          schema:
            type: number
            example: 1
          required: true
          description: The id of the application identity to link
        - in: path
          name: identityId
          schema:
            type: number
            example: 42
          required: true
          description: The id of the identity to link to
      responses:
        200:
          description: Successful response containing the linked application identity
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IdentityInApplication'
        404:
          $ref: '../thereabout.openapi.yaml#/components/responses/404'
        500:
          $ref: '../thereabout.openapi.yaml#/components/responses/500'
  IdentityInApplicationUnlink:
    put:
      summary: Unlink an application identity from its identity.
      tags:
        - identity-in-application
      operationId: unlinkIdentityInApplication
      parameters:
        - in: path
          name: id
          schema:
            type: number
            example: 1
          required: true
          description: The id of the application identity to unlink
      responses:
        200:
          description: Successful response containing the unlinked application identity
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IdentityInApplication'
        404:
          $ref: '../thereabout.openapi.yaml#/components/responses/404'
        500:
          $ref: '../thereabout.openapi.yaml#/components/responses/500'
  Message:
    get:
      summary: Get all messages for a given day.
      tags:
        - message
      operationId: getMessages
      parameters:
        - in: query
          name: date
          schema:
            type: string
            format: date
            example: "2024-01-15"
          required: true
          description: The date to retrieve messages for
      responses:
        200:
          description: Successful response containing all messages for the given day
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Message'
        400:
          $ref: '../thereabout.openapi.yaml#/components/responses/400'
        500:
          $ref: '../thereabout.openapi.yaml#/components/responses/500'

components:
  schemas:
    Identity:
      description: A person or contact identity.
      type: object
      required:
        - id
        - shortName
      properties:
        id:
          type: number
          description: The unique identifier of the identity
          example: 1
        shortName:
          type: string
          description: A short name or alias for the identity
          example: "johndoe"
        isGroup:
          type: boolean
          description: Whether this identity represents a group (e.g. a group chat)
          example: false
        relationship:
          type: string
          description: The relationship to the user
          example: "friend"
        identityInApplications:
          type: array
          x-field-extra-annotation: "@lombok.Builder.Default"
          items:
            $ref: '#/components/schemas/IdentityInApplication'
    IdentityInApplication:
      description: An identity's presence in a specific application (e.g. phone number in WhatsApp).
      type: object
      required:
        - id
        - application
        - identifier
      properties:
        id:
          type: number
          description: The unique identifier
          example: 1
        application:
          type: string
          description: The application name
          example: "WhatsApp"
        identifier:
          type: string
          description: The identifier within the application (e.g. phone number, username)
          example: "+41791234567"
    Message:
      description: A message between two identities.
      type: object
      required:
        - id
        - type
        - source
        - sender
        - receiver
        - timestamp
      properties:
        id:
          type: number
          description: The unique identifier of the message
          example: 1
        type:
          type: string
          description: The type of message
          example: "text"
        source:
          type: string
          description: The source application of the message
          example: "WhatsApp"
        sourceIdentifier:
          type: string
          description: An identifier for the source conversation or thread
          example: "chat-12345"
        sender:
          $ref: '#/components/schemas/MessageParticipant'
        receiver:
          $ref: '#/components/schemas/MessageParticipant'
        subject:
          type: string
          description: The subject of the message
          example: "Hello"
        body:
          type: string
          description: The body content of the message
          example: "Hey, how are you?"
        timestamp:
          type: string
          format: date-time
          description: The timestamp when the message was sent
          example: "2024-01-15T10:30:00Z"
    MessageParticipant:
      description: A resolved participant in a message conversation.
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Display name - identity short name if linked, otherwise the application identifier
          example: "johndoe"
        identityId:
          type: number
          description: The id of the linked identity, or null if unlinked
          example: 42
