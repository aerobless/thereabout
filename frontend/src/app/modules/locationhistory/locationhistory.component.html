<p-toolbar>
    <div class="p-toolbar-group-start">
        <b style="padding-left: 5px; padding-right: 5px">Thereabout üìç</b>
        <i style="font-size: small">near that place or time</i>
    </div>
    <div class="p-toolbar-group-center">
        <p-iconField iconPosition="left" class="toolbar-item">
            <p-inputIcon styleClass="pi pi-search"/>
            <input type="text" pInputText placeholder="Search" (keydown)="geocodeAddress($event)" style="width: 400px;"
                   [(ngModel)]="searchValue"/>
        </p-iconField>
        <p-button icon="pi pi-times" (onClick)="resetSearch()" class="button toolbar-item" severity="secondary"></p-button>
    </div>
    <div class="p-toolbar-group-end">
        <p-button icon="pi pi-cog" (onClick)="openConfiguration()" class="button toolbar-item" severity="secondary"></p-button>
    </div>
</p-toolbar>
<br>

<div style="display: flex; height: calc(100vh - 120px);">
    <!-- Google Maps Section -->
    <div style="flex-grow: 1;">
        <google-map width="100%" height="100%" [center]="center" [zoom]="zoom">
            <map-heatmap-layer [data]="heatmapData" [options]="heatmapOptions"></map-heatmap-layer>
            <map-polyline [path]="dayViewData"></map-polyline>
            <map-marker *ngIf="selectedLocationEntry" [position]="{lat: selectedLocationEntry.latitude, lng: selectedLocationEntry.longitude}"></map-marker>
        </google-map>
    </div>

    <!-- Right Side Panels -->
    <div style="display: flex; flex-direction: column;">
        <!-- Heatmap Panel -->
        <div style="padding: 0 0 10px 10px; width: 400px;">
            <p-panel header="Heatmap" [toggleable]="true">
                <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 20px">
                    <p-floatLabel style="padding-right: 10px">
                        <p-calendar [(ngModel)]="fromDate" (ngModelChange)="loadHeatmapData()" [iconDisplay]="'input'"
                                    [showIcon]="true" class="toolbar-item" id="from-date" dateFormat="dd.mm.yy"></p-calendar>
                        <label for="from-date">From</label>
                    </p-floatLabel>
                    <p-floatLabel>
                        <p-calendar [(ngModel)]="toDate" (ngModelChange)="loadHeatmapData()" [iconDisplay]="'input'"
                                    [showIcon]="true" class="toolbar-item" id="to-date" dateFormat="dd.mm.yy"></p-calendar>
                        <label for="to-date">To</label>
                    </p-floatLabel>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 20px">
                    <p-button label="YTD" [rounded]="true" severity="secondary" (onClick)="setQuickFilterForHeatmap(QuickFilterDateCombo.YTD)"></p-button>
                    <p-button label="1 year" [rounded]="true" severity="secondary" (onClick)="setQuickFilterForHeatmap(QuickFilterDateCombo.ONE_YEAR)"></p-button>
                    <p-button label="5 years" [rounded]="true" severity="secondary" (onClick)="setQuickFilterForHeatmap(QuickFilterDateCombo.FIVE_YEARS)"></p-button>
                    <p-button label="Full" [rounded]="true" severity="secondary" (onClick)="setQuickFilterForHeatmap(QuickFilterDateCombo.FULL_HISTORY)"></p-button>
                </div>
            </p-panel>
        </div>

        <!-- Day View Panel -->
        <div style="padding: 0 0 10px 10px; width: 400px;">
            <p-panel header="Day View" [toggleable]="true">
                <div class="dayview-date-selector">
                    <p-button icon="pi pi-chevron-left" (onClick)="decrementDate()" class="button toolbar-item" severity="secondary"></p-button>
                    <p-calendar [(ngModel)]="exactDate" (ngModelChange)="loadDayViewData()" [iconDisplay]="'input'"
                                [showIcon]="true" class="toolbar-item" #exactDateCalendarInput dateFormat="dd.mm.yy"></p-calendar>
                    <p-button icon="pi pi-chevron-right" (onClick)="incrementDate()" class="button toolbar-item" severity="secondary"></p-button>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 20px; padding-bottom: 20px;">
                    <p-button icon="pi pi-map-marker" label="Locate" [rounded]="true" severity="info" (onClick)="locateDayView()"></p-button>
                    <p-button icon="pi pi-image" label="Photos" [rounded]="true" severity="secondary" (onClick)="openGooglePhotos()"></p-button>
                    <p-button label="Reset" [rounded]="true" severity="secondary" (onClick)="setTodayForDayView()"></p-button>
                </div>
                <p-table
                        [value]="dayViewDataFull"
                        selectionMode="single"
                        [(selection)]="selectedLocationEntry"
                        styleClass="p-datatable-sm"
                        scrollable="true"
                        scrollHeight="calc(100vh - 500px)"
                        (onRowSelect)="onRowSelect($event)"
                        [metaKeySelection]="false" dataKey="id">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Time</th>
                            <th>Coordinates</th>
                            <th>Altitude</th>
                            <th>Action</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-locationEntry>
                        <tr [pSelectableRow]="locationEntry">
                            <td>{{convertToLocalTime(locationEntry.timestamp)}}</td>
                            <td><p style="font-size: small; white-space:pre-wrap; margin-top: 0; margin-bottom: 0">{{shortCoordinates(locationEntry.latitude,locationEntry.longitude)}}</p></td>
                            <td>{{locationEntry.altitude}}m</td>
                            <td><p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger" (onClick)="deleteLocationEntry(locationEntry)"/></td>
                        </tr>
                    </ng-template>
                </p-table>
            </p-panel>
        </div>
    </div>
</div>